<!DOCTYPE html>
<html>
<head>
<script>

/*the doExport() function that is trigger onclick here is passed to the master script
notice I make sure doExport will execute in context of this document by attaching it to
'this'. I take advantage of the fact that until I execute doExport the reference to structureJS 
is not resolved. This avoids refernce errors because I could not guarantee structureJS would
be loaded on time. There is obviously a better way to do this like maybe writing a mini script loaded
here that would execute master script then the logic contained here (in a file) next. Truthfully,
is works so I'm just going to leave it for now*/
var doExport = null;

window.sjsOnComplete = {};
window.sjsOnComplete.projectManagerContext = this;
window.sjsOnComplete.bind = function(){
  
  window.sjsOnComplete.projectManagerContext.doExport = function(){
    var exportData = {};
    exportData.files =  document.getElementById('target').value || '';
    exportData.base_dir =  document.getElementById('project_location').value || './';
    exportData.manifest_loc =  document.getElementById('project_manifest_location').value || './';
    exportData.manifest_name =  document.getElementById('project_manifest_name').value || 'manifest';
    
    structureJS.exportLoadData(exportData);
    if(structureJS.exportInitiated == false){
      structureJS.exportInit();
    }else{
      structureJS.exportUpdate();
    }
  }
  
};
/*Proejct Stroe Operations*/
function initProjectStore(){
  var projectStore = {}
  projectStore.projects = {};
  projectStore.lastOpened = '';
  if(typeof localStorage['project_store'] == 'undefined'){
    localStorage['project_store'] = JSON.stringify(projectStore);
  }
}
function getProjectStore(){
  return JSON.parse(localStorage['project_store']).projects;
}
function setProjectStore(projectStore){
  localStorage['project_store'] = JSON.stringify(projectStore);
}
function addProject(projectObj){
  var store = getProjectStore();
  store[projectObj.name] = projectObj;
  setProjectStore({ projects : store });
}
function deleteProject(projectName){
  var store = getProjectStore();
  if(projectName !== '' && typeof store[projectName] != 'undefined'){
    delete store[projectName];
    setProjectStore({ projects : store });
    console.log('Project: ' + projectName + ' Is Deleted From Store'); 
    console.log(getProjectStore()); 
  }else{
    console.log('Project Name Not Recognized');
  }
   
}

function saveProject(){
  var projectData = {};
  projectData.name = document.getElementById('project_name').value || '';
  projectData.files =  document.getElementById('target').value || '';
  projectData.base_dir =  document.getElementById('project_location').value || './';
  projectData.manifest_loc =  document.getElementById('project_manifest_location').value || './';
  projectData.manifest_name =  document.getElementById('project_manifest_name').value || 'manifest';
  
  if(projectData.name == ''){
    notifyUser('Project Must Have A Name');
    return false;
  }
  addProject(projectData);
  console.log( localStorage['project_store']);
}


function notifyUser(msg){
  console.log(msg);
}



window.onload = function(){
  initProjectStore();
  var deleteProjectBtn = document.getElementById('delete_project');
  deleteProjectBtn.addEventListener('click', function(){
  console.log('Click');
    deleteProject(document.getElementById('which_project').value);
  });
  
};

</script>
<script id="structureJS" 
        data-config="export-config"
        src="structureJS.js"/>
</script>

</head>
<body>
  <label for="project_location">Project Name: </label><input id="project_name" type="text"></input><br>
  <label for="project_location">Project Base Dir (Relative To This File): </label><input id="project_location" type="text"></input><br>
  <label for="project_manifest_name">Project Maniefest Name: </label><input id="project_manifest_name" type="text"></input> *Leave Blank If It's Named 'maifest'<br>
  <label for="project_manifest_location">Project Maniefest Location (Relative To Project Base Dir): </label><input id="project_manifest_location" type="text"></input><br>
  <label for="target">Target: </label><input id="target" type="text"></input>
  <br><label for="which_project">Delete Project: </label><input id="which_project" type="text"></input><button id="delete_project">Go</button>
  <br><button onclick="doExport()" id="export">Export</button>
  <br><button onclick="saveProject()" id="save_project">Save Project</button>
  <div id="minified"></div>
</body>

</html>